import{b as J,r as s,h as K,j as i,f as U}from"./index-CDzJiYq6.js";import{i as z,s as c,M as Q,T as X,h as Z,c as _}from"./tableExcel-CSYl1U_U.js";import{C as ee}from"./CommonPopup-CuyX368z.js";import{e as u}from"./errorMsgPopup-BRg64j45.js";import{m as te}from"./msgPopup-vJapftwn.js";import"./index-BD8OiV0R.js";const le=b=>({GU:[{value:"ALL",label:"전체"},{value:"EMPNO",label:"사원번호"},{value:"EMPNM",label:"이름"},{value:"ORGCD",label:"조직코드"},{value:"ORGNM",label:"조직명"},{value:"COMPANYCD",label:"회사코드"},{value:"COMPANYNM",label:"회사명"}]})[b]||[],ce=()=>{const{user:b}=J(),m=s.useRef(null),n=s.useRef(null),H=s.useRef(!0),w={areas:[{type:"search",fields:[{id:"GU",type:"select",row:1,label:"구분",labelVisible:!0,options:le("GU"),width:"150px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0},{id:"searchText",type:"text",row:1,label:"",labelVisible:!1,placeholder:"검색값을 입력하세요",maxLength:100,width:"200px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0}]},{type:"buttons",fields:[{id:"searchBtn",type:"button",row:1,label:"검색",eventType:"search",width:"80px",height:"30px",backgroundColor:"#00c4b4",color:"#ffffff",enabled:!0}]}]},P=[{id:"filterSelect",label:"",type:"select",options:[{value:"",label:"선택"},{value:"EMPNO",label:"사원번호"},{value:"EMPNM",label:"이름"},{value:"ORGCD",label:"조직코드"},{value:"ORGNM",label:"조직명"},{value:"COMPANYCD",label:"회사코드"},{value:"COMPANYNM",label:"회사명"},{value:"AUTHID",label:"권한ID"},{value:"AUTHNM",label:"권한명"}],width:"auto"},{id:"filterText",label:"",type:"text",placeholder:"검색값을 입력하세요",width:"200px"}],[C,R]=s.useState(z(w.areas.find(l=>l.type==="search").fields)),[T,k]=s.useState(z(P)),[A,f]=s.useState([]),[v,N]=s.useState([]),[h,g]=s.useState(!1),[p,x]=s.useState("initializing"),[j,M]=s.useState(!1),[S,y]=s.useState(null),[O,E]=s.useState({AUTHID:"",AUTHNM:""}),[F,G]=s.useState(0),[I,Y]=s.useState(!1);s.useEffect(()=>{(!b||!K(b.auth,"userAuthManage"))&&(window.location.href="/")},[b]),s.useEffect(()=>{(async()=>{var e,a;g(!0);try{const t=await U("oper/usermng/list",{pGUBUN:"AUTHINFO",pSEARCH:"",pDEBUG:"F"});if(!t.success){u(t.message||"권한 데이터를 가져오는 중 오류가 발생했습니다."),N([]);return}if(t.errMsg!==""){u(t.errMsg),N([]);return}N(Array.isArray(t.data)?t.data:[])}catch(r){u(((a=(e=r.response)==null?void 0:e.data)==null?void 0:a.message)||"권한 데이터를 가져오는 중 오류가 발생했습니다."),N([])}finally{g(!1)}})()},[]),s.useEffect(()=>((async()=>{if(await new Promise(e=>setTimeout(e,1e3)),!m.current){console.warn("테이블 컨테이너가 준비되지 않았습니다.");return}try{if(n.current=_(m.current,[{frozen:!0,headerHozAlign:"center",hozAlign:"center",title:"작업대상",field:"applyTarget",sorter:"string",width:100,formatter:e=>{const a=e.getRow().getData();let r=a.isChanged==="Y"?"변경":"";if(!r)return"";const t=document.createElement("div");t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.gap="5px";const o=document.createElement("input");o.type="checkbox",o.checked=a.isChanged==="Y",o.onclick=()=>{setTimeout(()=>{f(q=>q.map(D=>D.EMPNO===a.EMPNO?{...D,isChanged:o.checked?"Y":"N"}:D))},0)};const d=document.createElement("span");return d.innerText=r,t.appendChild(o),t.appendChild(d),t}},{headerHozAlign:"center",hozAlign:"center",title:"사원번호",field:"EMPNO",sorter:"string",width:100,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"이름",field:"EMPNM",sorter:"string",width:100,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"조직코드",field:"ORGCD",sorter:"string",width:100,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"조직명",field:"ORGNM",sorter:"string",width:150,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"회사코드",field:"COMPANYCD",sorter:"string",width:100,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"회사명",field:"COMPANYNM",sorter:"string",width:150,editable:!1},{headerHozAlign:"center",hozAlign:"center",title:"권한ID",field:"AUTHID",sorter:"string",width:100,editable:!1,cellClick:(e,a)=>{y(a.getRow().getData().EMPNO),M(!0)},cellStyle:{backgroundColor:"#d3d3d3"}},{headerHozAlign:"center",hozAlign:"left",title:"권한명",field:"AUTHNM",sorter:"string",width:150,editable:!1,cellClick:(e,a)=>{y(a.getRow().getData().EMPNO),M(!0)},cellStyle:{backgroundColor:"#d3d3d3"}}],[],{editable:!1,rowFormatter:e=>{const a=e.getData(),r=e.getElement();r.classList.remove(c.editedRow),a.isChanged==="Y"&&r.classList.add(c.editedRow)}}),!n.current)throw new Error("createTable returned undefined or null");x("ready")}catch(e){x("error"),console.error("Table initialization failed:",e.message)}})(),()=>{n.current&&(n.current.destroy(),n.current=null,x("initializing"))}),[]),s.useEffect(()=>{var e;if(H.current){H.current=!1;return}const l=n.current;if(!(!l||p!=="ready"||h)&&(e=l.rowManager)!=null&&e.renderer)if(l.setData(A),I&&A.length===0&&!h)n.current.alert("검색 결과 없음","info");else{n.current.clearAlert();const a=n.current.getDataCount();G(a)}},[A,h,p,I]),s.useEffect(()=>{if(!n.current||p!=="ready"||h)return;const{filterSelect:l,filterText:e}=T;e&&l?n.current.setFilter(l,"like",e):e&&e!==""?n.current.setFilter([{field:"EMPNO",type:"like",value:e},{field:"EMPNM",type:"like",value:e},{field:"ORGCD",type:"like",value:e},{field:"ORGNM",type:"like",value:e},{field:"COMPANYCD",type:"like",value:e},{field:"COMPANYNM",type:"like",value:e},{field:"AUTHID",type:"like",value:e},{field:"AUTHNM",type:"like",value:e}],"or"):n.current.clearFilter()},[T,p,h]);const L=l=>{l==="search"&&B()},B=async()=>{var l,e;g(!0),Y(!0);try{const a={pGUBUN:C.GU||"ALL",pSEARCH:C.searchText||"",pDEBUG:"F"},r=await U("oper/usermng/list",a);if(!r.success){u(r.message||"사용자 데이터를 가져오는 중 오류가 발생했습니다."),f([]);return}if(r.errMsg!==""){f([]);return}const t=Array.isArray(r.data)?r.data:[];f(t.map(o=>({...o,isChanged:"N"})))}catch(a){u(((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"사용자 데이터를 가져오는 중 오류가 발생했습니다."),f([])}finally{g(!1)}},$=()=>{if(!S)return;const l=O.AUTHID;f(e=>e.map(a=>{if(a.EMPNO===S){const r=v.find(t=>t.AUTHID===l);return{...a,AUTHID:l,AUTHNM:r?r.AUTHNM:"",isChanged:a.isChanged==="N"?"Y":a.isChanged}}return a})),n.current&&n.current.redraw(),M(!1),y(null),E({AUTHID:"",AUTHNM:""})},V=()=>{M(!1),y(null),E({AUTHID:"",AUTHNM:""})},W=async()=>{const l=A.filter(e=>e.isChanged==="Y");if(l.length===0){u("변경된 데이터가 없습니다.");return}g(!0);try{const e=l.map(async t=>{const o={pGUBUN:"I",pEMPNO:t.EMPNO,pAUTHID:t.AUTHID};try{const d=await U("oper/usermng/save",o);if(!d.success)throw new Error(d.message||`Failed to update user ${t.EMPNO}`);return{...t,success:!0}}catch(d){return console.error(`Error processing update for EMPNO: ${t.EMPNO}`,d),{...t,error:d.message}}}),r=(await Promise.all(e)).filter(t=>t==null?void 0:t.error);r.length>0?u(`일부 작업이 실패했습니다: ${r.map(t=>t.error).join(", ")}`):(te("모든 변경사항이 성공적으로 저장되었습니다."),f(t=>t.map(o=>({...o,isChanged:"N"}))))}catch(e){u(e.message||"저장 중 오류가 발생했습니다.")}finally{g(!1)}};return i.jsxs("div",{className:c.container,children:[i.jsx(Q,{config:w,filters:C,setFilters:R,onEvent:L}),i.jsx(X,{filterFields:P,filters:T,setFilters:k,rowCount:F,onDownloadExcel:()=>Z(n.current,p,"사용자권한관리.xlsx"),buttonStyles:c,children:i.jsx("div",{className:c.btnGroupCustom,children:i.jsx("button",{className:`${c.btn} text-bg-success`,onClick:W,children:"저장"})})}),i.jsxs("div",{className:c.tableWrapper,children:[p==="initializing"&&i.jsx("div",{children:"초기화 중..."}),h&&i.jsx("div",{children:"로딩 중..."}),i.jsx("div",{ref:m,className:c.tableSection,style:{visibility:h||p!=="ready"?"hidden":"visible"}})]}),i.jsx(ee,{show:j,onHide:V,onConfirm:$,title:"권한 선택",children:i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{htmlFor:"authIdSelect",className:"form-label",children:"권한"}),i.jsxs("select",{className:`form-select ${c.formSelect}`,id:"authIdSelect",value:O.AUTHID,onChange:l=>{const e=v.find(a=>a.AUTHID===l.target.value);E({AUTHID:l.target.value,AUTHNM:e?e.AUTHNM:""})},children:[i.jsx("option",{value:"",children:"선택하세요"}),v.map(l=>i.jsx("option",{value:l.AUTHID,children:l.AUTHNM},l.AUTHID))]})]})})]})};export{ce as default};
//# sourceMappingURL=UserAuthManage-J9oZN0xW.js.map
