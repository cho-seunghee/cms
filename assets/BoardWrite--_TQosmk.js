import{a as Q,u as X,b as Y,r as u,h as Z,j as t,f as S,c as ee}from"./index-CDzJiYq6.js";import{e as f}from"./errorMsgPopup-BRg64j45.js";import{m as V}from"./msgPopup-vJapftwn.js";import{s as r}from"./Board.module-DCwUm73g.js";import{f as i}from"./fileUtils-BeuIT3kH.js";const oe=()=>{var D,z;const{state:n}=Q(),N=X(),{user:C}=Y(),o=!!(n!=null&&n.notice),L=(n==null?void 0:n.files)||[];u.useEffect(()=>(i.setAccept("*"),()=>{i.getAccept()}),[]);const E=L.map(e=>({...e,size:e.fileSize||0,isValid:i.isValidFile(e)})),M=E.length>=i.getMaxFiles()?[]:[{id:Date.now()}],[p,P]=u.useState(((D=n==null?void 0:n.notice)==null?void 0:D.title)||""),[x,U]=u.useState(((z=n==null?void 0:n.notice)==null?void 0:z.content)||""),[a,w]=u.useState(M),[b,v]=u.useState(new Array(M.length).fill(null)),[j,q]=u.useState(E),[F,y]=u.useState(!1);u.useEffect(()=>{if(!C||!Z(C.auth,"mainBoard")){N("/");return}},[C,N]);const B=()=>{j.length+a.length<i.getMaxFiles()&&(w([...a,{id:Date.now()}]),v([...b,null]))},W=e=>{const l=a.findIndex(s=>s.id===e);if(l!==-1){if(a.length>1){const s=a.filter(h=>h.id!==e),c=b.filter((h,d)=>d!==l);w(s),v(c);return}w([{id:Date.now()+1}]),v([null])}},_=async e=>{var l;if(window.confirm("파일을 삭제하시겠습니까?")){if(!o||!((l=n==null?void 0:n.notice)!=null&&l.id)){f("공지사항 ID가 존재하지 않습니다. 수정 모드에서만 파일 삭제가 가능합니다.");return}try{const s={gubun:"D",fileId:String(e.fileId),noticeId:String(n.notice.id)},c=await S("notice/filedelete",s);if(c.errCd!=="00")throw new Error(c.errMsg||"파일 삭제 실패");q(j.filter(d=>d.fileId!==e.fileId)),j.length-1+a.length<i.getMaxFiles()&&a.length===0&&(w([{id:Date.now()}]),v([null]))}catch(s){console.error("Error deleting file:",s),f(s.message||"파일 삭제 중 오류가 발생했습니다.")}}},G=(e,l)=>{const s=l.target.files[0];if(s){if(s.size>i.getMaxFileSize()){f(`파일 크기는 ${i.formatFileSize(i.getMaxFileSize())}를 초과할 수 없습니다.`);return}if(!i.isValidFile(s)){f("문서 파일(pdf, doc, docx, xls, xlsx, ppt, pptx)만 업로드 가능합니다.");return}const c=a.findIndex(d=>d.id===e);if(c===-1)return;const h=[...b];h[c]=s,v(h)}},H=async e=>{var d,$,R;e.preventDefault();const l=((d=n==null?void 0:n.notice)==null?void 0:d.title)||"",s=(($=n==null?void 0:n.notice)==null?void 0:$.content)||"";if(!o&&(!p||!x)||o&&p!==l&&!p||o&&x!==s&&!x){f("제목과 내용을 입력해주세요.");return}y(!0);try{const m=o?"U":"I",k=o?String(n.notice.id):"0",I=await S("notice/save",{gubun:m,noticeId:k,title:p,content:x});if(I.errCd!=="00")throw new Error(I.errMsg||"공지사항 저장 실패");const K=o?k:(R=I.data)==null?void 0:R.noticeId,T=b.filter(g=>g!=null);if(T.length>0){const g=new FormData;g.append("gubun","I"),g.append("fileId",""),g.append("noticeId",K),T.forEach(O=>{g.append("files",O)});const A=await ee("notice/filesave",g);if(A.errCd!=="00")throw new Error(A.errMsg||"파일 업로드 실패")}V(o?"공지사항이 성공적으로 변경되었습니다.":"공지사항이 성공적으로 등록되었습니다."),N("/main")}catch(m){console.error("공지사항 저장 실패:",{message:m.message,response:m.response?{status:m.response.status,data:m.response.data,headers:m.response.headers}:"No response received"}),f(m.message||"공지사항 저장 중 오류가 발생했습니다.")}finally{y(!1)}},J=async()=>{if(window.confirm("정말 삭제하시겠습니까?")){y(!0);try{const l={gubun:"D",noticeId:String(n.notice.id),title:p||"",content:x||""},s=await S("notice/save",l);if(s.errCd!=="00")throw new Error(s.errMsg||"공지사항 삭제 실패");V("공지사항이 성공적으로 삭제되었습니다."),N("/main")}catch(e){console.error("공지사항 삭제 실패:",e),f(e.message||"공지사항 삭제 중 오류가 발생했습니다.")}finally{y(!1)}}};return t.jsxs("div",{className:"container bg-body",children:[t.jsx("h2",{className:`text-primary text-dark fs-5 mb-4 pt-3 ${r.boardTitle}`,children:o?"공지 변경":"공지 등록"}),t.jsx("div",{className:r.boardTitleLine}),t.jsxs("form",{onSubmit:H,children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"제목"}),t.jsx("input",{className:`form-control bg-light-subtle ${r.formControl}`,value:p,onChange:e=>P(e.target.value),placeholder:"제목을 입력하세요",required:!0})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"내용"}),t.jsx("textarea",{className:`form-control bg-light-subtle ${r.formControl}`,rows:"5",value:x,onChange:e=>U(e.target.value),placeholder:"내용을 입력하세요",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"form-label",children:["첨부파일 ",t.jsxs("span",{className:"text-muted",children:["(최대 ",i.getMaxFiles(),"개까지만 첨부 가능하며, ",i.formatFileSize(i.getMaxFileSize()),"까지만 가능합니다. 문서 파일만 업로드 가능.)"]})]}),j.length>0&&t.jsxs("div",{className:"mb-3",children:[t.jsx("h6",{children:"기존 첨부파일:"}),j.map(e=>t.jsxs("div",{className:"d-flex align-items-center mb-2",children:[t.jsxs("span",{className:"me-2",children:[e.fileName," (",i.formatFileSize(e.size),")",!e.isValid&&t.jsx("span",{className:"text-danger ms-2",children:"(문서 파일이 아님)"})]}),t.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>_(e),children:"-"})]},e.fileId))]}),a&&a.length>0?a.map((e,l)=>t.jsxs("div",{className:"d-flex align-items-center mb-2",children:[t.jsx("input",{type:"file",className:`form-control bg-light-subtle ${r.formControl} me-2`,onChange:s=>G(e.id,s),accept:i.getAccept()}),t.jsx("button",{type:"button",className:"btn btn-outline-danger me-2",onClick:()=>W(e.id),children:"-"}),l===a.length-1&&t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:B,disabled:j.length+a.length>=i.getMaxFiles(),children:"+"})]},e.id)):t.jsx("div",{}),b.some(e=>e!=null)&&t.jsxs("div",{className:"mt-3",children:[t.jsx("h6",{children:"선택된 파일:"}),t.jsx("ul",{children:b.map((e,l)=>e&&t.jsxs("li",{children:[e.name," (",i.formatFileSize(e.size),")"]},l))})]})]}),t.jsxs("div",{className:"btn-group-custom d-flex justify-content-end gap-2 mb-3 mt-5",children:[t.jsx("button",{type:"button",className:`btn ${r.btnCancel}`,onClick:()=>N("/main"),children:"취소"}),o?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"submit",className:`btn ${r.btnMod}`,disabled:F,children:F?"저장 중...":"변경"}),t.jsx("button",{type:"button",className:`btn btn-danger ${r.btnDel}`,onClick:J,disabled:F,children:F?"삭제 중...":"삭제"})]}):t.jsx("button",{type:"submit",className:`btn ${r.btnReg}`,disabled:F,children:F?"저장 중...":"등록"})]})]})]})};export{oe as default};
//# sourceMappingURL=BoardWrite--_TQosmk.js.map
