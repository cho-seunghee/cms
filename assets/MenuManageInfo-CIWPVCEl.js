import{b as de,u as Ee,r as d,h as Ne,j as s,e as A,f as H}from"./index-CDzJiYq6.js";import{C as _}from"./CommonPopup-CuyX368z.js";import{i as B,s as o,M as ue,T as Ue,h as fe,c as Me}from"./tableExcel-CSYl1U_U.js";import{e as m}from"./errorMsgPopup-BRg64j45.js";import{m as he}from"./msgPopup-vJapftwn.js";import"./index-BD8OiV0R.js";const G={editor:"input",editable:!0},me={editor:"number",editorParams:{min:0},editable:!0},W=E=>({editor:"list",editorParams:{values:E,autocomplete:!0},editable:!0}),pe=(E,p,L)=>({formatter:g=>{const h=document.createElement("button");return h.className=`btn btn-sm ${p}`,h.innerText=E,h.onclick=()=>L(g.getData()),h}}),I=(E,p,L,g)=>{const h=E.getRow().getData().MENUID,D=E.getValue();if(p==="MENUNM"){const N=A.validateVarcharLength(D,100,"메뉴명");if(!N.valid){m(N.error);return}}else if(p==="URL"){const N=A.validateVarcharLength(D,250,"URL");if(!N.valid){m(N.error);return}}setTimeout(()=>{L(N=>N.map(x=>{if(String(x.MENUID)===String(h)){const M={...x,[p]:D};return M.isDeleted==="N"&&M.isAdded==="N"&&(M.isChanged="Y"),M}return x})),g.current&&g.current.redraw()},0)},ge=(E,p,L)=>{const g=E.getRow().getData(),D=E.getTable().getData().find(N=>String(N.MENUID)===String(g.UPPERMENUID));return D?L(D.MENUNM,D.MENULEVEL):"없음"},De=E=>({USEYN:[{value:"",label:"전체"},{value:"Y",label:"사용"},{value:"N",label:"미사용"}]})[E]||[],ve=()=>{const{user:E}=de(),p=Ee(),L={areas:[{type:"search",fields:[{id:"MENUNM",type:"text",row:1,label:"메뉴명",labelVisible:!0,placeholder:"메뉴명 검색",maxLength:100,width:"200px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0},{id:"USEYN",type:"select",row:1,label:"사용",labelVisible:!0,options:De("USEYN"),width:"150px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0}]},{type:"buttons",fields:[{id:"searchBtn",type:"button",row:1,label:"검색",eventType:"search",width:"80px",height:"30px",backgroundColor:"#00c4b4",color:"#ffffff",enabled:!0}]}]},g=[{id:"filterSelect",label:"",type:"select",options:[{value:"",label:"선택"},{value:"MENUNM",label:"메뉴명"},{value:"URL",label:"URL"},{value:"USEYN",label:"사용"}]},{id:"filterText",label:"",type:"text",placeholder:"찾을 내용을 입력하세요",width:"200px"}],[h,D]=d.useState(B(L.areas.find(e=>e.type==="search").fields)),[N,x]=d.useState(B(g)),[M,v]=d.useState(!1),[R,u]=d.useState([]),[k,q]=d.useState(!1),[Y,C]=d.useState("initializing"),[J,y]=d.useState(!1),[K,j]=d.useState(!1),[S,w]=d.useState(null),[a,U]=d.useState({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"}),[Q,X]=d.useState(1),[Z,ee]=d.useState(0),F=d.useRef(null),i=d.useRef(null),z=d.useRef(!0),V=(e,t)=>t<=1?e:`${"  ".repeat(t-1)}└${e}`,te=[{frozen:!0,headerHozAlign:"center",hozAlign:"center",title:"작업",field:"actions",width:80,visible:!0,...pe("삭제",`btn-danger ${o.deleteButton}`,e=>oe(e))},{frozen:!0,headerHozAlign:"center",hozAlign:"center",title:"작업대상",field:"applyTarget",sorter:"string",width:100,formatter:e=>{const t=e.getRow().getData();let l="",n="";if(t.isDeleted==="Y"?(l="삭제",n="isDeleted"):t.isAdded==="Y"?(l="추가",n="isAdded"):t.isChanged==="Y"&&(l="변경",n="isChanged"),!l)return"";const c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.gap="5px";const r=document.createElement("input");r.type="checkbox",r.checked=t[n]==="Y",r.onclick=()=>{setTimeout(()=>{u(T=>T.map(b=>{if(b.MENUID===t.MENUID){const $={...b,[n]:r.checked?"Y":"N"};return n==="isDeleted"&&!r.checked&&($.isChanged="N"),n==="isAdded"&&!r.checked?null:$}return b}).filter(Boolean))},0)};const f=document.createElement("span");return f.innerText=l,c.appendChild(r),c.appendChild(f),c}},{headerHozAlign:"center",hozAlign:"center",title:"ID",field:"MENUID",sorter:"string",width:100},{headerHozAlign:"center",hozAlign:"left",title:"메뉴명",field:"MENUNM",sorter:"string",width:200,...G,cellEdited:e=>I(e,"MENUNM",u,i)},{headerHozAlign:"center",hozAlign:"center",title:"상위메뉴",field:"UPPERMENUID",sorter:"string",width:120,formatter:e=>ge(e,R,V),cellClick:(e,t)=>{w(t.getRow().getData().MENUID),U({...a,UPPERMENUID:t.getRow().getData().UPPERMENUID||""}),j(!0)}},{headerHozAlign:"center",hozAlign:"left",title:"URL",field:"URL",sorter:"string",width:300,...G,cellEdited:e=>I(e,"URL",u,i)},{headerHozAlign:"center",hozAlign:"center",title:"레벨",field:"MENULEVEL",sorter:"number",width:80,editable:!1},{headerHozAlign:"center",hozAlign:"center",title:"하위포함",field:"LEAFMENUYN",sorter:"string",width:100,...W(["Y","N"]),cellEdited:e=>I(e,"LEAFMENUYN",u,i)},{headerHozAlign:"center",hozAlign:"center",title:"순서",field:"MENUORDER",sorter:"number",width:80,...me,cellEdited:e=>I(e,"MENUORDER",u,i)},{headerHozAlign:"center",hozAlign:"center",title:"사용",field:"USEYN",sorter:"string",width:80,...W(["Y","N"]),cellEdited:e=>I(e,"USEYN",u,i)}],O=async()=>{var e,t;v(!0),q(!0);try{const l={MENUNM:h.MENUNM||"",USEYN:h.USEYN||"",DEBUG:"F"},n=await H("oper/menumng/list",l);if(!n.success){m(n.message||"메뉴 데이터를 가져오는 중 오류가 발생했습니다."),u([]);return}if(n.errMsg!==""){u([]);return}const c=Array.isArray(n.data)?n.data:[],r=c.map(f=>({...f,MENULEVEL:P(f,c),MENUORDER:Number(f.MENUORDER),isDeleted:"N",isEdited:"N",isAdded:"N"}));u(r)}catch(l){console.error("데이터 로드 실패:",l),m(((t=(e=l.response)==null?void 0:e.data)==null?void 0:t.message)||"메뉴 데이터를 가져오는 중 오류가 발생했습니다."),u([])}finally{v(!1)}},P=(e,t,l=new Set)=>{if(!e.UPPERMENUID||l.has(e.MENUID))return 1;l.add(e.MENUID);const n=t.find(c=>c.MENUID===e.UPPERMENUID);return n?P(n,t,l)+1:1};d.useEffect(()=>{(!E||!Ne(E.auth,"menuManage"))&&p("/")},[E,p]),d.useEffect(()=>((async()=>{if(await new Promise(t=>setTimeout(t,1e3)),!F.current){console.warn("테이블 컨테이너가 준비되지 않았습니다.");return}try{if(i.current=Me(F.current,te,[],{editable:!0,rowFormatter:t=>{const l=t.getData(),n=t.getElement();n.classList.remove(o.deletedRow,o.addedRow,o.editedRow),l.isDeleted==="Y"?n.classList.add(o.deletedRow):l.isAdded==="Y"?n.classList.add(o.addedRow):l.isChanged==="Y"&&n.classList.add(o.editedRow)}}),!i.current)throw new Error("createTable returned undefined or null");C("ready")}catch(t){C("error"),console.error("Table initialization failed:",t.message)}})(),()=>{i.current&&(i.current.destroy(),i.current=null,C("initializing"))}),[]),d.useEffect(()=>{var t;if(z.current){z.current=!1;return}const e=i.current;if(!(!e||Y!=="ready"||M))if((t=e.rowManager)!=null&&t.renderer)if(e.setData(R),k&&R.length===0&&!M)i.current.alert("검색 결과 없음","info");else{i.current.clearAlert();const l=i.current.getDataCount();ee(l)}else console.warn("renderer가 아직 초기화되지 않았습니다.")},[R,M,Y,k]),d.useEffect(()=>{if(z.current||!i.current||Y!=="ready"||M)return;const{filterSelect:e,filterText:t}=N;t&&e?i.current.setFilter(e,"like",t):t?t!==""?i.current.setFilter([{field:"MENUNM",type:"like",value:t},{field:"URL",type:"like",value:t},{field:"USEYN",type:"like",value:t}],"or"):i.current.clearFilter():e&&i.current.clearFilter()},[N.filterSelect,N.filterText,Y,M]);const se=e=>{e==="search"&&O()},le=()=>{U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"}),y(!0)},ne=()=>{const e=A.validateVarcharLength(a.MENUNM,100,"메뉴명");if(!e.valid){m(e.error);return}const t=A.validateVarcharLength(a.URL,250,"URL");if(!t.valid){m(t.error);return}if(!a.MENUNM.trim()){m("메뉴명을 입력해주세요.");return}if(!a.MENUORDER||isNaN(a.MENUORDER)){m("메뉴 순서를 숫자로 입력해주세요.");return}const n={MENUID:`IMSI${String(Q).padStart(4,"0")}`,MENUNM:a.MENUNM,UPPERMENUID:a.UPPERMENUID,URL:a.URL,MENULEVEL:a.MENULEVEL,LEAFMENUYN:a.LEAFMENUYN,MENUORDER:parseInt(a.MENUORDER),USEYN:a.USEYN,isDeleted:"N",isEdited:"N",isAdded:"Y"};u(c=>[n,...c]),X(c=>c+1),y(!1),U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"})},re=()=>{y(!1),U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"})},ae=()=>{if(!S)return;const e=a.UPPERMENUID,t=e?P({UPPERMENUID:e,MENUID:S},R):1;u(l=>l.map(n=>n.MENUID===S?{...n,UPPERMENUID:e,MENULEVEL:t,isChanged:n.isDeleted==="N"&&n.isAdded==="N"?"Y":n.isChanged}:n)),i.current&&i.current.redraw(),j(!1),w(null),U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"})},ie=()=>{j(!1),w(null),U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"})},oe=e=>{setTimeout(()=>{if(e.isAdded==="Y")u(t=>t.filter(l=>l.MENUID!==e.MENUID));else{const t=e.isDeleted==="Y"?"N":"Y";u(l=>l.map(n=>n.MENUID===e.MENUID?{...n,isDeleted:t,isChanged:t==="Y"?"N":n.isChanged}:n))}},0)},ce=async e=>{e.preventDefault();const t=R.filter(l=>l.isDeleted==="Y"&&l.isAdded!=="Y"||l.isAdded==="Y"||l.isChanged==="Y"&&l.isDeleted==="N");if(t.length===0){m("변경된 데이터가 없습니다.");return}v(!0);try{const l=t.map(async r=>{let f="";r.isDeleted==="Y"&&r.isAdded!=="Y"?f="D":r.isAdded==="Y"?f="I":r.isChanged==="Y"&&r.isDeleted==="N"&&(f="U");const T={pGUBUN:f,pMENUID:r.MENUID,pMENUNM:r.MENUNM||"",pUPPERMENUID:r.UPPERMENUID||"",pURL:r.URL||"",pMENULEVEL:String(r.MENULEVEL)||"1",pMENUORDER:String(r.MENUORDER)||"",pUSEYN:r.USEYN||"Y"};try{const b=await H("oper/menumng/save",T);if(!b.success)throw new Error(b.message||`Failed to ${f} menu ${r.MENUID}`);return{...r,success:!0}}catch(b){return console.error(`Error processing ${f} for MENUID: ${r.MENUID}`,b),{...r,success:!1,error:b.message}}}),c=(await Promise.all(l)).filter(r=>!r.success);c.length>0?m(`일부 작업이 실패했습니다: ${c.map(r=>r.error).join(", ")}`):(he("모든 변경사항이 성공적으로 저장되었습니다."),await O())}catch(l){console.error("Save operation failed:",l),m(l.message||"저장 중 오류가 발생했습니다.")}finally{v(!1)}};return s.jsxs("div",{className:o.container,children:[s.jsx(ue,{config:L,filters:h,setFilters:D,onEvent:se}),s.jsx(Ue,{filterFields:g,filters:N,setFilters:x,rowCount:Z,onDownloadExcel:()=>fe(i.current,Y,"메뉴관리.xlsx"),buttonStyles:o,children:s.jsxs("div",{className:o.btnGroupCustom,children:[s.jsx("button",{className:`${o.btn} text-bg-primary`,onClick:le,children:"추가"}),s.jsx("button",{className:`${o.btn} text-bg-success`,onClick:ce,children:"저장"})]})}),s.jsxs("div",{className:o.tableWrapper,children:[Y==="initializing"&&s.jsx("div",{children:"초기화 중..."}),M&&s.jsx("div",{children:"로딩 중..."}),s.jsx("div",{ref:F,className:o.tableSection,style:{visibility:M||Y!=="ready"?"hidden":"visible"}})]}),s.jsxs(_,{show:J,onHide:re,onConfirm:ne,title:"메뉴 추가",children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"메뉴명"}),s.jsx("input",{type:"text",className:`form-control ${o.formControl}`,value:a.MENUNM,onChange:e=>U({...a,MENUNM:e.target.value}),placeholder:"메뉴명을 입력하세요"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"상위메뉴"}),s.jsxs("select",{className:`form-select ${o.formSelect}`,value:a.UPPERMENUID,onChange:e=>{const t=e.target.value,l=t?P({UPPERMENUID:t,MENUID:"temp"},R):1;U({...a,UPPERMENUID:t,MENULEVEL:String(l)})},children:[s.jsx("option",{value:"",children:"없음"}),R.filter(e=>e.MENUID!==a.MENUID).map(e=>s.jsx("option",{value:e.MENUID,children:V(e.MENUNM,e.MENULEVEL)},e.MENUID))]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"URL"}),s.jsx("input",{type:"text",className:`form-control ${o.formControl}`,value:a.URL,onChange:e=>U({...a,URL:e.target.value}),placeholder:"URL을 입력하세요"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"메뉴순서"}),s.jsx("input",{type:"number",className:`form-control ${o.formControl}`,value:a.MENUORDER,onChange:e=>U({...a,MENUORDER:e.target.value}),placeholder:"메뉴 순서를 입력하세요"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"하위포함"}),s.jsxs("select",{className:`form-select ${o.formSelect}`,value:a.LEAFMENUYN,onChange:e=>U({...a,LEAFMENUYN:e.target.value}),children:[s.jsx("option",{value:"Y",children:"Y"}),s.jsx("option",{value:"N",children:"N"})]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"사용"}),s.jsxs("select",{className:`form-select ${o.formSelect}`,value:a.USEYN,onChange:e=>U({...a,USEYN:e.target.value}),children:[s.jsx("option",{value:"Y",children:"Y"}),s.jsx("option",{value:"N",children:"N"})]})]})]}),s.jsx(_,{show:K,onHide:ie,onConfirm:ae,title:"상위메뉴 선택",children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"상위메뉴"}),s.jsxs("select",{className:`form-select ${o.formSelect}`,value:a.UPPERMENUID,onChange:e=>U({...a,UPPERMENUID:e.target.value}),children:[s.jsx("option",{value:"",children:"없음"}),R.filter(e=>e.MENUID!==S).map(e=>s.jsx("option",{value:e.MENUID,children:V(e.MENUNM,e.MENULEVEL)},e.MENUID))]})]})})]})};export{ve as default};
//# sourceMappingURL=MenuManageInfo-CIWPVCEl.js.map
